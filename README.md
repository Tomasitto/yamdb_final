# yamdb_final
![workflow](https://github.com/Tomasitto/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg?)


Учебный проект для изучения работы CI CD (Яндекс Практикум)

###Проект развернут по адресу: http://localhost:8000/redoc/
###Документация доступна по эндпойнту: http://localhost:8000/redoc/

## Описание
Данный проект является проектом учебного курса Яндекс Практикум по специальности Python-разработчик.

* Проект собирает отзывы (Review) пользователей на произведения (Titles). 
* Произведения делятся на категории: «Книги», «Фильмы», «Музыка». 
* Список категорий (Category) может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).
* Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.
* В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.
* Произведению может быть присвоен жанр (Genre) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.
* Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). 
* На одно произведение пользователь может оставить только один отзыв.
## Установка

* Создайте файл infra_sp2/infra/.env
* Заполните его данными по образцу:

DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres1 # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД
SECRET_KEY = "Your_secret_key"

* Установите Docker, соответствующий вашей операционной системе
* Запустите Docker
* Откройте командную строку вашей операционной системы.
* Перейдите в директорию проекта infra_sp2/infra/

## В командной строке выполните команды:
* Команда для сборки образов и запуска контейнеров:
docker-compose up -d --build
* Выполнить миграции:
docker-compose exec web python manage.py migrate
* Копировать статические файлы в директорию static, медиа файлы в директорию media:
docker-compose exec web python manage.py collectstatic --no-input
* Создать суперпользователя:
docker-compose exec web python manage.py createsuperuser

## Загрузка тестовых данных
В репозитории, в директории /api_yamdb/static/data, находятся несколько файлов в формате csv с контентом для ресурсов Users, Titles, Categories, Genres, Review и Comments.
* Залить данные из файлов csv в БД можно, импортировав данные командой:
python manage.py import_csv
* Можно восстановить базу данных из файла infra_sp2/infra/nginx/fixtures.json командой
docker-compose exec web python manage.py loaddata fixtures.json

## Примеры
Пользователь аутентифицируется посредством сервиса Simple JWT.
* Получите код подтверждения регистрации.
* Отправьте POST запрос с именем пользователя и e-mail на эндпойнт:
http://127.0.0.1:8000/api/v1/auth/signup/

Пример успешного ответа:
{
    "username": "Tomas",
    "email": "tomas00@gmail.com"
}

* Получите токен для доступа к функциям сервиса проекта. 
Отправьте POST запрос с именем пользователя и полученным по e-mail кодом подтвреждения на эндпойнт:
http://127.0.0.1:8000/api/v1/auth/token/

POST request:

{
    "username": "Tomas",
    "confirmation_code": "9134d504-1e4c-40f1-81a5-b3baf357e3e3"
}

Response:

{
    "refresh": "Your_Token_Here",
    "access": "Your_Access_Token_Here"
}

* Можно заполнить пустые поля в своем профайле, отправив PATCH запрос на эндпойнт:
http://127.0.0.1:8000/api/v1/users/me/

{
    "username": "auf",
    "email": "tomas@mail.com",
    "role": "user",
    "bio": "My biography.",
    "first_name": "Tomas",
    "last_name": "Mann"
}

* Получение информации о произведении GET запрос:

http://127.0.0.1:8000/api/v1/titles/{titles_id}/

Response:

{
    "id": 5,
    "rating": 5,
    "genre": [
        {
            "name": "Комедия",
            "slug": "comedy"
        },
        {
            "name": "Детектив",
            "slug": "detective"
        },
        {
            "name": "Триллер",
            "slug": "thriller"
        }
    ],
    "category": {
        "name": "Фильм",
        "slug": "movie"
    },
    "name": "Криминальное чтиво",
    "year": 1994,
    "description": null
}


### В проекте использованы технологии:
- Python
- Django
- Django REST Framework
- Simple JWT
- Docker
- Postgres
- Gunicorn
- Nginx


